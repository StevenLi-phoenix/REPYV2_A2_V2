"""
Attack 3: Write to an older version (e.g., name.v1) after it exists.
Expected secure behavior: writing to older versions must be disallowed.
This test logs ONLY if the write is wrongly allowed.
"""

# Ensure a base and a version exist
try:
    f1 = openfile("wdn2012_t3", True)
    try:
        f1.writeat("orig", 0)
    except Exception:
        pass
    try:
        f1.close()
    except Exception:
        pass
except Exception:
    pass

try:
    f2 = openfile("wdn2012_t3", True)  # create a version
    try:
        f2.close()
    except Exception:
        pass
except Exception:
    pass

# Attempt to write to version v1
try:
    v1 = openfile("wdn2012_t3.v1", False)
    try:
        v1.writeat("bad", 0)
        log("EXPLOIT: wrote to an older version")
    except Exception:
        pass
    finally:
        try:
            v1.close()
        except Exception:
            pass
except Exception:
    pass


