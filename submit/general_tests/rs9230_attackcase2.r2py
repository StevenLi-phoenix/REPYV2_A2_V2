f1 = openfile("datafile.txt", True)
f1.writeat("version 1", 0)
f1.close()

# Create second version
f2 = openfile("datafile.txt", True)
f2.writeat("version 2", 0)
f2.close()

# Try to open and write to the OLD version (v1)
try:
    f3 = openfile("datafile.txt.v1", False)
    f3.writeat("hacked", 0)
    log("ATTACK SUCCESSFUL: Wrote to old version file (immutability violated)\n")
    f3.close()
    exitall()
except FileInUseError:
    # Expected - old versions should be immutable
    try:
        f3.close()
    except:
        pass
except Exception as e:
    # Expected - any exception that prevents writing
    try:
        f3.close()
    except:
        pass

log("Test passed - old versions are immutable\n")