mycontext['handles'] = []
mycontext['lock'] = createlock()

def thread_open_version():
    try:
        v = openfile("multiopenversion.txt.v1", False)
        mycontext['lock'].acquire(True)
        mycontext['handles'].append(v)
        mycontext['lock'].release()
        sleep(0.2)
        v.close()
    except Exception as e:
        pass

try:
    f = openfile("multiopenversion.txt", True)
    f.writeat("base", 0)
    f.close()
    
    f2 = openfile("multiopenversion.txt", True)
    f2.writeat("v1", 0)
    f2.close()
    
    for i in range(3):
        createthread(thread_open_version)
    
    sleep(0.5)
    
    for h in mycontext['handles']:
        try:
            h.close()
        except:
            pass

except Exception as e:
    pass
