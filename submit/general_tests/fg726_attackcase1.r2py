

# Setup: create bases and one version each
try:
    a = openfile("lfa", True); a.writeat("a", 0); a.close()
    av1 = openfile("lfa", True); av1.close()
    b = openfile("lfb", True); b.writeat("b", 0); b.close()
    bv1 = openfile("lfb", True); bv1.close()
except Exception as e:
    raise Exception("Setup failed: %s" % e)

# Test: listfiles() must show only base names and include both bases
lf = listfiles()
has_a = False
has_b = False
i = 0
while i < len(lf):
    n = lf[i]
    if n == "lfa":
        has_a = True
    if n == "lfb":
        has_b = True
    # If any returned name contains ".v" immediately followed by digit, fail
    j = 0
    while j < len(n) - 1:
        try:
            if n[j] == '.' and n[j+1] == 'v':
                raise Exception("listfiles() exposed version: %s" % n)
        except Exception:
            # re-raise so test harness sees it
            raise
        j = j + 1
    i = i + 1

if not (has_a and has_b):
    raise Exception("listfiles() does not show required base names")
# silent on success