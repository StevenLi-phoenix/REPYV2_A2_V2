marker = "compromised_vs3518_attackcase3"
protected = "protected_attack3.txt"
link = "link_attack3"
temp = "temp_attack3.txt"

try:
    f = open(protected, "w")
    try:
        f.write("ORIGINAL\n")
    finally:
        f.close()
except Exception:
    pass

try:
    f = open(temp, "w")
    try:
        f.write("EVIL\n")
    finally:
        f.close()
except Exception:
    pass

try:
    try:
        if os.path.exists(link):
            try:
                os.unlink(link)
            except Exception:
                pass
    except Exception:
        pass

    try:
        os.symlink(protected, link)
    except Exception:
        pass

    try:
        os.rename(temp, link)
    except Exception:
        pass
except Exception:
    pass

try:
    f = open(protected, "r")
    try:
        c = f.read()
    finally:
        f.close()
    try:
        if "EVIL" in c:
            open(marker, "w").close()
    except Exception:
        pass
except Exception:
    pass
